{% load static %}
<form hx-get="{% url 'trip_packages' %}" hx-target="#trip-package-list">
    <div class="join join-vertical w-full">
        <!-- Price Slider -->
        <div class="collapse collapse-arrow join-item border border-base-300">
            <input type="radio" name="filter" />
            <div class="collapse-title text-xl font-medium flex items-center">
                <img src="{% static 'web_elements/svg_icons/trip_icons/price_icon.svg' %}" 
                    alt="Price Icon"
                    class="w-6 h-6 mr-2 filter-icon">
                Price
            </div>
            <div class="collapse-content">
                <div class="flex justify-between">
                    <label class="btn btn-sm">Up to:</label>
                    <p id="max-price-label" class="btn btn-sm">€{{ price_range.max_price }}</p>
                </div>
                <input type="range" id="max-price" name="price" 
                       min="{{ price_range.min_price }}" 
                       max="{{ price_range.max_price }}"
                       value="{{ price_range.max_price }}"
                       class="range range-sm range-warning mt-1" />
            </div>
        </div>
        {% for filter_name, filter_items in filters.items %}
        {% if filter_name != "price" %}
        <div class="collapse collapse-arrow join-item border border-base-300">
            <input type="radio" name="filter" /> 
            <div class="collapse-title text-xl font-medium flex items-center">
                <img src="{% static 'web_elements/svg_icons/trip_icons/'|add:filter_name|add:'_icon.svg' %}" 
                     alt="{{ filter_name|capfirst }} Icon"
                     class="w-6 h-6 mr-2 filter-icon">
                {{ filter_name|capfirst }}
            </div>
            <div class="collapse-content">
                <ul class="flex-col">
                    {% if filter_name == "season" %}
                        {% for season, months in filter_items.items %}
                            <div class="collapse collapse-arrow join-item border border-base-300 mt-2">
                                <input type="radio" name="season-filter" />
                                <div class="collapse-title font-medium">
                                    {{ season }}
                                </div>
                                <div class="collapse-content">
                                    <ul>
                                        {% for month in months %}
                                            <li class="flex mt-2">
                                                <input type="checkbox" 
                                                       class="checkbox mr-2" 
                                                       name="{{ filter_name }}" 
                                                       value="{{ month.value }}">
                                                {{ month.display }}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        {% for item in filter_items %}
                            <li class="flex mt-2">
                                <input type="checkbox" 
                                       class="checkbox mr-2" 
                                       name="{{ filter_name }}" 
                                       value="{{ item.value }}">
                                {{ item.display }}
                            </li>
                        {% endfor %}
                    {% endif %}
                </ul>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    <button class="btn w-full mt-2" type="submit">Apply Filters</button>
</form>


<script>
    // Function to update all #max-price and #max-price-label elements
    function syncMaxPrice(value) {
        var maxPriceInputs = document.querySelectorAll('#max-price');
        var maxPriceLabels = document.querySelectorAll('#max-price-label');
        
        maxPriceInputs.forEach(function(input) {
            input.value = value;
        });

        maxPriceLabels.forEach(function(label) {
            label.innerText = '€' + value;
        });
    }

    // Listen for changes on any #max-price element
    document.body.addEventListener('input', function(event) {
        if (event.target.id === 'max-price') {
            syncMaxPrice(event.target.value);
        }
    });

    //  Function for trip count
    document.addEventListener('DOMContentLoaded', function() {
        document.body.addEventListener('htmx:afterOnLoad', function(event) {
            var tripCountElement = document.getElementById('trip-count');
            var tripItems = document.querySelectorAll('#trip-package-list .trip-item').length;
            var expeditionText = tripItems === 1 ? ' Expedition' : ' Expeditions';
            tripCountElement.innerHTML = '<strong>' + tripItems + '</strong>' + expeditionText;
        });
    });

    
</script>